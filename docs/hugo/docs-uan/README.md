# UAN Docs generated by Hugo

In this directory are all the files needed to generate UAN documentation in
static HTML format from the markdown source.

## Building the HTML Documentation

To build the HTML files for the UAN documentation, run the `bin/build.sh` script
from the `docs/hugo/docs-uan` directory.

The `bin/build.sh` script performs the following steps:

1. Clones the UAN markdown docs from the `uan-product-stream` GitHub repo to
`docs/hugo/docs-uan/docs-uan/<release>` for each release listed in the `RELEASES`
array variable defined in `bin/build.sh`.

    1. The following example shows the v2.3.0 and v2.1.9 releases of the `uan-product-stream`.
    The releases to be cloned are defined by the `RELEASES` array variable in
    `bin/build.sh`.

        ```bash
        RELEASES=(v2.3.0 v2.1.9)
        ```

        1. When additional releases are defined in `RELEASES`, additional
        definitions must be made in the following files.

            1. `docs/hugo/docs-uan/config.toml`

                New Hugo `languages` must be defined in
                `docs/hugo/docs-uan/config.toml` for each new release.

                The following example is the entry for the `v2.3.0` branch. The
                language name is `en-230`. The `contentDir` value is the
                location where Hugo creates the HTML content relative to
                `docs/hugo/docs-uan`. This path will always be `content/<release>`,
                where `<release>` is the name of the release.
                For each additional release/language, increase the `weight` value
                by 10.  The `landingPageURL` defines where the release/language
                HTML pages will start on the webserver.

                ```bash
                [languages]
                  [languages.en-230]
                    contentDir = "content/v2.3.0"
                    languageName = "2.3"
                    weight = 10
                    landingPageURL = "/docs-uan/en-230"
                ```

            1. `docs/hugo/docs-uan/bin/compose/hugo_prep.yml`

                New Hugo prep services must be defined in
                `docs/hugo/docs-uan/bin/compose/hugo_prep.yml` for each new
                release.

                The following example is the entry for the `v2.3.0` release.
                When adding new releases, change `hugo_prep_en_230` to
                `hugo_prep_en_<release>`, where `<release>` is the release name
                and update the `UAN_RELEASE` value to the release name.

                ```bash
                hugo_prep_en_230:
                  container_name: hugo_prep_en_230
                  image: ubuntu
                  environment:
                    UAN_RELEASE: v2.3.0 
                  volumes:
                    - ${PWD}:/src
                  entrypoint:
                    - /src/bin/convert-docs-to-hugo.sh
                    - --source
                    - /src/docs-uan/
                    - --destination
                    - /src/content/
                ```

            1. `docs/hugo/docs-uan/bin/compose/test.yml`

                New Hugo linkcheck services must be defined in
                `docs/hugo/docs-uan/bin/compose/test.yml` for each new release tag.

                The following example is the entry for the `v2.3.0` release.
                When adding new branches, change `linkcheck_en_230` to
                `linkcheck_en_<release>`, where `<release>` is the release name
                update the `container_name` value with the release name.
                Update `en-<release>` in the command to the new `en-<release>` and
                increment the `ipv4_address`.

                ```bash
                linkcheck_en_230:
                  build: ${PWD}/bin/compose/build/linkchecker
                  container_name: uan_docs_linkcheck_230
                  depends_on:
                    - serve_static
                  image: filiph/linkcheck
                  command:
                    - http://10.253.253.2/uan/docs-uan/en-230
                  networks:
                    uan_documentation:
                      ipv4_address: 10.253.253.3
                ```

            1. `docs/hugo/docs-uan/bin/build.sh`

                Update `bin/build.sh` with the new linkcheck service.
                Add the new linkcheck service name (`linkcheck_en_<release>)
                after the `linkcheck_en_<release>` in the following section of the
                file.

                ```bash
                # Crawl the links for each version
                docker-compose -f $THIS_DIR/compose/test.yml up --no-color
                --remove-orphans \
                linkcheck_en_<release> linkcheck_en_<new-release> | tee -a uan_docs_build.log
                ```

1. Prepare the contents of the UAN documentation markdown
files for use with Hugo.  These files will be in placed in
the `docs/hugo/docs-uan/content` directory.

1. Generate the HTML files from the
`docs/hugo/docs-uan/content` and place them in the
`docs/hugo/docs-uan/public` directory.

## Viewing the HTML UAN Documentation

To view the generated documentation locally, run the
`bin/dev.sh` script from `docs/hugo/docs-uan`.  The
`bin/dev.sh` script starts a webserver and hosts the
UAN documentation at `http://localhost/uan`.

Alternatively, the contents of `docs/hugo/docs-uan/public`
may be copied to any webserver.
