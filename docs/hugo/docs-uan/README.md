# UAN Docs generated by Hugo

In this directory are all the files needed to generate UAN documentation in
static HTML format from the markdown source.

## Building the HTML Documentation

To build the HTML files for the UAN documentation, run the `bin/build.sh` script
from the `docs/hugo/docs-uan` directory.

The `bin/build.sh` script performs the following steps:

1. Clone the UAN markdown docs from the `uan-product-stream` GitHub repo to 
`docs/hugo/docs-uan/docs-uan/<branch>` for each branch listed in the `BRANCHES`
array variable defined in `bin/build.sh`.

    1. By default, the `main` branch of the `uan-product-stream` is cloned.
    The branches to be cloned are defined by the `BRANCHES` array variable in
    `bin/build.sh`.

        ```bash
        BRANCHES=(main)
        ```

        1. When additional branches are defined in `BRANCHES`, additional
        definitions must be made in the following files.

            1. `docs/hugo/docs-uan/config.toml`

                New Hugo `languages` must be defined in
                `docs/hugo/docs-uan/config.toml` for each new branch.

                The following example is the entry for the `main` branch. The
                language name is `en-main`. The `contentDir` value is the
                location where Hugo creates the HTML content relative to
                `docs/hugo/docs-uan`. This path will always be `content/<branch>`,
                where `<branch>` is the name of the branch.
                For each additional branch/language, increase the `weight` value
                by 10.  The `landingPageURL` defines where the branch/language
                HTML pages will start on the webserver.

                ```bash
                [languages]
                  [languages.en-main]
                    contentDir = "content/main"
                    languageName = "main"
                    weight = 10
                    landingPageURL = "/docs-uan/en-main"
                ```

            1. `docs/hugo/docs-uan/bin/compose/hugo_prep.yml`

                New Hugo prep services must be defined in
                `docs/hugo/docs-uan/bin/compose/hugo_prep.yml` for each new
                branch.

                The following example is the entry for the `main` branch.
                When adding new branches, change `hugo_prep_en_main` to
                `hugo_prep_en_<branch>`, where `<branch>` is the branch name
                and update the `UAN_BRANCH` value to the branch name.

                ```bash
                hugo_prep_en_main:
                  container_name: hugo_prep_en_main
                  image: ubuntu
                  environment:
                    UAN_BRANCH: main 
                  volumes:
                    - ${PWD}:/src
                  entrypoint:
                    - /src/bin/convert-docs-to-hugo.sh
                    - --source
                    - /src/docs-uan/
                    - --destination
                    - /src/content/
                ```

            1. `docs/hugo/docs-uan/bin/compose/test.yml`

                New Hugo linkcheck services must be defined in
                `docs/hugo/docs-uan/bin/compose/test.yml` for each new branch.

                The following example is the entry for the `main` branch.
                When adding new branches, change `linkcheck_en_main` to
                `linkcheck_en_<branch>`, where `<branch>` is the branch name
                update the `container_name` value with the branch name.
                Update `en-main` in the command to `en-<branch>` and
                increment the `ipv4_address`.

                ```bash
                linkcheck_en_main:
                  build: ${PWD}/bin/compose/build/linkchecker
                  container_name: uan_docs_linkcheck_main
                  depends_on:
                    - serve_static
                  image: filiph/linkcheck
                  command:
                    - http://10.253.253.2/uan/docs-uan/en-main
                  networks:
                    uan_documentation:
                      ipv4_address: 10.253.253.3
                ```

            1. `docs/hugo/docs-uan/bin/build.sh`

                Update `bin/build.sh` with the new linkcheck service.
                Add the new linkcheck service name (`linkcheck_en_<branch>)
                after the `linkcheck_en_main` in the following section of the
                file.

                ```bash
                # Crawl the links for each version
                docker-compose -f $THIS_DIR/compose/test.yml up --no-color
                --remove-orphans \
                linkcheck_en_main linkcheck_en_<branch> | tee -a uan_docs_build.log
                ```

1. Prepare the contents of the UAN documentation markdown
files for use with Hugo.  These files will be in placed in
the `docs/hugo/docs-uan/content` directory.

1. Generate the HTML files from the
`docs/hugo/docs-uan/content` and place them in the
`docs/hugo/docs-uan/public` directory.

## Viewing the HTML UAN Documentation

To view the generated documentation locally, run the
`bin/dev.sh` script from `docs/hugo/docs-uan`.  The
`bin/dev.sh` script starts a webserver and hosts the
UAN documentation at `http://localhost/uan`.

Alternatively, the contents of `docs/hugo/docs-uan/public`
may be copied to any webserver.
